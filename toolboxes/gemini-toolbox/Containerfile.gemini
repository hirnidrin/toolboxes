FROM ghcr.io/ublue-os/wolfi-toolbox

LABEL com.github.containers.toolbox="true" \
      usage="This image is meant to be used with the Toolbox or Distrobox commands" \
      summary="Google Gemini CLI container powered by Wolfi"

# Get list of additional packages to add
COPY ./toolboxes/gemini-toolbox/packages.gemini /toolbox-packages

# Update image, add additional packages
RUN apk update && \
    apk upgrade && \
    grep -v '^#' /toolbox-packages | xargs apk add && \
    rm /toolbox-packages

# Install global node packages -- example using npm, creates:
#   tree -a -L 2 /usr/lib/node_modules/
#   /usr/lib/node_modules/
#   └── npm
#       ├── LICENSE
#       ├── bin
#       ├── dont-check-for-last-version.patch
#       ├── index.js
#       ├── lib
#       ├── man -> ../../../share/man
#       ├── node_modules               -- the npm packages required for globally installed packages
#       ├── npmrc                      -- global npm config:
#           cat /usr/lib/node_modules/npm/npmrc 
#           # Do not modify this file - use /etc/npmrc instead!
#           globalconfig=/etc/npmrc
#           globalignorefile=/etc/npmignore
#           prefix=/usr/local
#           python=/usr/bin/python3
#       └── package.json
#   /usr/lib/bin/...                   -- executable symlinks point to related package bins in above tree
RUN npm i -g @google/gemini-cli && \
    rm -rf /root/.npm

# Change root shell to BASH
RUN sed -i -e '/^root/s/\/bin\/ash/\/bin\/bash/' /etc/passwd
